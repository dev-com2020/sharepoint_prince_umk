<script>
    document.addEventListener("DOMContentLoaded", async function () {
        const formTable = document.querySelector(".ms-formtable");
        if (!formTable) {
            console.error("Nie znaleziono tabeli formularza.");
            return;
        }

        // Funkcja pobierająca ID z URL
        function getFormID() {
            const params = new URLSearchParams(window.location.search);
            return params.get("ID") || "0"; // Domyślne ID, jeśli nie znaleziono
        }

        // Pobierz ID formularza
        const formID = getFormID();
        console.log("Aktualne ID formularza:", formID);

        // Definicja sekcji na podstawie ID
        const rows = Array.from(formTable.querySelectorAll("tr"));
        let sections;

        if (formID === "28") {
            sections = [
                { title: "SEKCJA 1 - Dla ID 28", range: [0, 2] },
                { title: "SEKCJA 2 - Dla ID 28", range: [3, 5] },
                { title: "SEKCJA 3 - Dla ID 28", range: [6, rows.length - 1] },
            ];
        } else {
            sections = [
                { title: "SEKCJA 1 - Inne", range: [0, 3] },
                { title: "SEKCJA 2 - Inne", range: [4, rows.length - 1] },
            ];
        }

        // Funkcja budująca sekcje
        function buildSections() {
            sections.forEach(section => {
                const sectionDiv = document.createElement("div");
                sectionDiv.className = "form-section";

                const sectionHeader = document.createElement("div");
                sectionHeader.textContent = section.title;
                sectionHeader.className = "section-header";

                const sectionContent = document.createElement("div");
                sectionContent.className = "section-content";
                rows.slice(section.range[0], section.range[1] + 1).forEach(row => {
                    sectionContent.appendChild(row);
                });

                sectionContent.style.display = "none";
                sectionHeader.style.cursor = "pointer";

                sectionHeader.addEventListener("click", () => {
                    sectionContent.style.display =
                        sectionContent.style.display === "none" ? "block" : "none";
                });

                sectionDiv.appendChild(sectionHeader);
                sectionDiv.appendChild(sectionContent);
                formTable.parentNode.insertBefore(sectionDiv, formTable);
            });

            formTable.style.display = "none";
        }

        // Uruchomienie budowy sekcji
        buildSections();
    });
    // Dodanie informacji o trybie edycji
    const modeInfo = document.createElement("div");
    modeInfo.className = "mode-info";
    const toolbar = document.querySelector(".ms-formtoolbar"); // Pasek narzędzi formularza
    if (toolbar && toolbar.textContent.includes("Zapisz")) {
      modeInfo.textContent = "Formularz jest w trybie odczytu.";
    } else {
      modeInfo.textContent = "Formularz jest w trybie edycji.";
    }
    document.body.insertBefore(modeInfo, document.body.firstChild);
</script>

<style>
    .mode-info {
      background-color: #f32873;
      color: #000;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      border-bottom: 2px solid #e6b800;
      margin-bottom: 20px;
    }
    .form-section {
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
    }

    .section-header {
        background-color: #0078d7;
        color: white;
        padding: 10px;
        font-size: 16px;
        border-radius: 5px 5px 0 0;
        cursor: pointer;
    }

    .section-header:hover {
        background-color: #005a9e;
    }

    .section-content {
        display: none;
        padding: 10px;
        background-color: #f9f9f9;
        border: 1px solid #ccc;
        border-top: none;
    }
</style>
