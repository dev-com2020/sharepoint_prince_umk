<script>

  document.addEventListener('DOMContentLoaded', () => {
   
      const targetAnchor = document.querySelector('a[name="SPBookmark_Pracownik_x0020_odp_x002e__x0020"]');
      
      if (targetAnchor) {
          // Utwórz nowy element <div>
          const newDiv = document.createElement('div');
          newDiv.textContent = "Osoby / Daty / Zatwierdzenia / Uwagi";
  
          // Dodanie klas zamiast stylów inline dla spójności
          newDiv.className = "custom-banner";
          
          // Wstaw nowy <div> przed elementem <a>
          targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
      } else {
          console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
      }
  });
  document.addEventListener('DOMContentLoaded', () => {

      const targetAnchor = document.querySelector('a[name="SPBookmark_Numer_x0020_przedsi_x0119_wzi_x0"]');
      
      if (targetAnchor) {
          // Utwórz nowy element <div>
          const newDiv = document.createElement('div');
          newDiv.textContent = "Informacje ogólne";
  
          // Dodanie klas zamiast stylów inline dla spójności
          newDiv.className = "custom-banner";
          
          // Wstaw nowy <div> przed elementem <a>
          targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
      } else {
          console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
      }
  });
  document.addEventListener('DOMContentLoaded', () => {

      const targetAnchor = document.querySelector('a[name="SPBookmark_Typ_x0020_projektu_x0020_wg_x002"]');
      
      if (targetAnchor) {
          // Utwórz nowy element <div>
          const newDiv = document.createElement('div');
          newDiv.textContent = "Typ / Ocena Punktowa / Skala Projektu";
  
          // Dodanie klas zamiast stylów inline dla spójności
          newDiv.className = "custom-banner";
          
          // Wstaw nowy <div> przed elementem <a>
          targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
      } else {
          console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
      }
  });
  document.addEventListener('DOMContentLoaded', () => {

      const targetAnchor = document.querySelector('a[name="SPBookmark_USE_x0020_Projektu_x0020__x002d_"]');
      
      if (targetAnchor) {
          // Utwórz nowy element <div>
          const newDiv = document.createElement('div');
          newDiv.textContent = "Uzasadnienie Społeczno-Ekonomiczne Projektu";
  
          // Dodanie klas zamiast stylów inline dla spójności
          newDiv.className = "custom-banner";
          
          // Wstaw nowy <div> przed elementem <a>
          targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
      } else {
          console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
      }
  });
  document.addEventListener('DOMContentLoaded', () => {

const targetAnchor = document.querySelector('a[name="SPBookmark_Opis_x002f_przeznaczenie_x0020_P"]');

if (targetAnchor) {
    // Utwórz nowy element <div>
    const newDiv = document.createElement('div');
    newDiv.textContent = "Opis Produktu Końcowego Projektu";

    // Dodanie klas zamiast stylów inline dla spójności
    newDiv.className = "custom-banner";
    
    // Wstaw nowy <div> przed elementem <a>
    targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
} else {
    console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
}
});
document.addEventListener('DOMContentLoaded', () => {

const targetAnchor = document.querySelector('a[name="SPBookmark_Formu_x0142_a_x0020_realizacji_x"]');

if (targetAnchor) {
    // Utwórz nowy element <div>
    const newDiv = document.createElement('div');
    newDiv.textContent = "Formuła Realizacji i Dodatkowe Informacje Dotyczące Finansowania Projektu";

    // Dodanie klas zamiast stylów inline dla spójności
    newDiv.className = "custom-banner";
    
    // Wstaw nowy <div> przed elementem <a>
    targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
} else {
    console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
}
});
document.addEventListener('DOMContentLoaded', () => {

const targetAnchor = document.querySelector('a[name="SPBookmark_Integracja_x0020_z_x0020_innymi_"]');

if (targetAnchor) {
    // Utwórz nowy element <div>
    const newDiv = document.createElement('div');
    newDiv.textContent = "Informacje Dotyczące Projektów Informatycznych";

    // Dodanie klas zamiast stylów inline dla spójności
    newDiv.className = "custom-banner";
    
    // Wstaw nowy <div> przed elementem <a>
    targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
} else {
    console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
}
});
document.addEventListener('DOMContentLoaded', () => {

const targetAnchor = document.querySelector('a[name="SPBookmark_PEI_x0020__x002d__x0020_Planowan"]');

if (targetAnchor) {
    // Utwórz nowy element <div>
    const newDiv = document.createElement('div');
    newDiv.textContent = "Plan Etapu Inicjowania";

    // Dodanie klas zamiast stylów inline dla spójności
    newDiv.className = "custom-banner";
    
    // Wstaw nowy <div> przed elementem <a>
    targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
} else {
    console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
}
});
document.addEventListener('DOMContentLoaded', () => {

const targetAnchor = document.querySelector('a[name="SPBookmark_Kierownik_x0020_Projektu"]');

if (targetAnchor) {
    // Utwórz nowy element <div>
    const newDiv = document.createElement('div');
    newDiv.textContent = "Osoby / Daty / Zatwierdzenia / Uwagi";

    // Dodanie klas zamiast stylów inline dla spójności
    newDiv.className = "custom-banner";
    
    // Wstaw nowy <div> przed elementem <a>
    targetAnchor.parentNode.insertBefore(newDiv, targetAnchor);
} else {
    console.warn('Nie znaleziono znacznika <a> z określonym atrybutem "name".');
}
});
  
  
    document.addEventListener("DOMContentLoaded", async function () {
      const formTable = document.querySelector(".ms-formtable");
      if (!formTable) {
        console.error("Nie znaleziono tabeli formularza.");
        return;
      }
  
      // Definicja sekcji formularza
      const rows = Array.from(formTable.querySelectorAll("tr"));
      const sections = [
        { title: "SEKCJA 1", range: [0, 31] },
        { title: "SEKCJA 2", range: [32, 74] },
        { title: "SEKCJA 3", range: [75, rows.length - 1] },
      ];
  
      // Grupy, które mają dostęp do rozwijania sekcji
      const allowedGroups = [
        "ADMINISTRATORZY TECHNICZNI (SZZ)",
        "GOSPODARCZE (SZZ)",
        "SPECJALIŚCI DS. SZP (SZZ)",
      ];
  
  
      // Funkcja sprawdzająca, czy użytkownik należy do grupy
      async function isUserInAllowedGroup() {
        try {
          const response = await fetch(
            `${_spPageContextInfo.webAbsoluteUrl}/_api/web/currentuser?$expand=Groups`,
            {
              headers: {
                Accept: "application/json;odata=verbose",
              },
            }
          );
  
          if (!response.ok) {
            throw new Error("Błąd podczas pobierania informacji o użytkowniku.");
          }
  
          const data = await response.json();
          const userGroups = data.d.Groups.results.map(group => group.Title);
          return userGroups.some(userGroup =>
            allowedGroups.some(allowedGroup => userGroup.includes(allowedGroup))
          );
        } catch (error) {
          console.error(error);
          return false; // Domyślnie brak dostępu w razie błędu
        }
      }
  
      // Funkcja budująca sekcje
      async function buildSections() {
        const hasAccess = await isUserInAllowedGroup();
  
        sections.forEach(section => {
          const sectionDiv = document.createElement("div");
          sectionDiv.className = "form-section";
  
          const sectionHeader = document.createElement("div");
          sectionHeader.textContent = section.title;
          sectionHeader.className = "section-header";
  
          const sectionContent = document.createElement("div");
          sectionContent.className = "section-content";
          rows.slice(section.range[0], section.range[1] + 1).forEach(row => {
            sectionContent.appendChild(row);
          });
  
          // Zablokowanie rozwijania sekcji dla użytkowników spoza grup
          if (section.title === "SEKCJA 3") {
            isUserInAllowedGroup().then(hasAccess => {
              if (!hasAccess) {
                sectionContent.style.display = "none";
                sectionHeader.style.backgroundColor = "#ccc"; // Zablokowana sekcja w szarym kolorze
                sectionHeader.style.cursor = "not-allowed";
              } else {
                sectionContent.style.display = "none";
                sectionHeader.style.cursor = "pointer";
  
                sectionHeader.addEventListener("click", () => {
                  sectionContent.style.display =
                    sectionContent.style.display === "none" ? "block" : "none";
                });
              }
            }).catch(error => {
              console.error("Error checking user group access:", error);
            });
          } else {
            sectionContent.style.display = "none";
            sectionHeader.style.cursor = "pointer";
  
            sectionHeader.addEventListener("click", () => {
              sectionContent.style.display =
                sectionContent.style.display === "none" ? "block" : "none";
            });
          }
  
          sectionDiv.appendChild(sectionHeader);
          sectionDiv.appendChild(sectionContent);
          formTable.parentNode.insertBefore(sectionDiv, formTable);
        });
  
        formTable.style.display = "none";
      }
  
      // Uruchomienie budowy sekcji
      buildSections();
    });
    // Dodanie informacji o trybie edycji
    const modeInfo = document.createElement("div");
    modeInfo.className = "mode-info";
    const toolbar = document.querySelector(".ms-formtoolbar"); // Pasek narzędzi formularza
    if (toolbar && toolbar.textContent.includes("Zapisz")) {
      modeInfo.textContent = "Formularz jest w trybie edycji.";
    } else {
      modeInfo.textContent = "Formularz jest w trybie odczytu.";
    }
    document.body.insertBefore(modeInfo, document.body.firstChild);
  </script>
  
  <style>
  /* Styl nowego banera */
  .custom-banner {
    background-color: #0078d7; /* Dopasowanie koloru do reszty strony */
    color: white;
    padding: 10px; /* Zmniejszony padding dla bardziej kompaktowego wyglądu */
    margin-bottom: 5px; /* Mniejszy odstęp poniżej */
    font-family: Arial, sans-serif; /* Dopasowanie czcionki */
    font-size: 14px; /* Mniejsza, ale nadal czytelna czcionka */
    border-radius: 4px; /* Delikatniejsze zaokrąglenie */
    text-align: center; /* Wyśrodkowanie tekstu */
    font-weight: 600; /* Trochę mniej wyróżnione, ale wciąż czytelne */
    line-height: 1.4; /* Zmniejszenie odstępu między liniami tekstu */
}

  
  /* Hover efekt dla banera */
  .custom-banner:hover {
      background-color: #005a9e; /* Ciemniejszy kolor na hover */
      cursor: default; /* Nie wskazuje interakcji */
  }
  
  
      #O365_MainLink_NavMenu /* Ukrywa menu aplikacji */ {
          display: none !important;
      }
    /* Informacja o trybie edycji */
    .mode-info {
      background-color: #e6b800;
      color: #000;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      border-bottom: 2px solid #e6b800;
      margin-bottom: 20px;
    }
  
    /* Stylizacja sekcji */
    .form-section {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
    }
  
    .section-header {
      background-color: #0078d7;
      color: white;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px 5px 0 0;
      cursor: pointer;
    }
  
    .section-header:hover {
      background-color: #005a9e;
    }
  
    .section-content {
      display: none;
      padding: 10px;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      border-top: none;
    }
  </style>