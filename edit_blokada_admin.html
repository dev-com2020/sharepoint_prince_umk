<script>
        
      // Grupy, które mają dostęp do rozwijania sekcji
      const allowedGroups = [
        "ADMINISTRATORZY TECHNICZNI (SZZ)",
        "GOSPODARCZE (SZZ)",
        "SPECJALIŚCI DS. SZP (SZZ)",
      ];
    
    
      // Funkcja sprawdzająca, czy użytkownik należy do grupy
      async function isUserInAllowedGroup() {
        try {
          const response = await fetch(
            `${_spPageContextInfo.webAbsoluteUrl}/_api/web/currentuser?$expand=Groups`,
            {
              headers: {
                Accept: "application/json;odata=verbose",
              },
            }
          );
    
          if (!response.ok) {
            throw new Error("Błąd podczas pobierania informacji o użytkowniku.");
          }
    
          const data = await response.json();
          const userGroups = data.d.Groups.results.map(group => group.Title);
          return userGroups.some(userGroup => 
            allowedGroups.some(allowedGroup => userGroup.includes(allowedGroup))
          );
        } catch (error) {
          console.error(error);
          return false; // Domyślnie brak dostępu w razie błędu
        }
      }
    
      // Funkcja budująca sekcje
      async function getListFields(listName) {
      try {
        const response = await fetch(
          `${_spPageContextInfo.webAbsoluteUrl}/_api/web/lists/getbytitle('${listName}')/fields`,
          {
            headers: {
              Accept: "application/json;odata=verbose",
            },
          }
        );

        if (!response.ok) {
          throw new Error("Błąd podczas pobierania pól listy.");
        }

        const data = await response.json();
        return data.d.results;
      } catch (error) {
        console.error(error);
        return [];
      }
    }

    async function createFormSections(listName) {
      const fields = await getListFields(listName);
      const rows = Array.from(document.querySelectorAll("#formTable tr"));
      const sections = fields.map((field, index) => ({
        title: field.Title,
        range: [index, index],
      }));

      // Przykład: dodanie sekcji do DOM
      sections.forEach(section => {
        const sectionElement = document.createElement("div");
        sectionElement.innerHTML = `<h3>${section.title}</h3>`;
        document.body.appendChild(sectionElement);
      });
    }
    // Pobierz nazwę listy z kontekstu strony
    const listName = _spPageContextInfo.listTitle;
    // Wywołanie funkcji z nazwą listy
    createFormSections(listName);
    </script>
    
    <style>
    /* Informacja o trybie edycji */
    .mode-info {
      background-color: #e30c0c;
      color: #000;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      font-size: 16px;
      border-bottom: 2px solid #e6b800;
      margin-bottom: 20px;
    }
    
    /* Stylizacja sekcji */
    .form-section {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
    }
    
    .section-header {
      background-color: #0078d7;
      color: white;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px 5px 0 0;
      cursor: pointer;
    }
    
    .section-header:hover {
      background-color: #005a9e;
    }
    
    .section-content {
      display: none;
      padding: 10px;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      border-top: none;
    }
    </style>
    