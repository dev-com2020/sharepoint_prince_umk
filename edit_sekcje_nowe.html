<script>
  (async function () {
    document.addEventListener('DOMContentLoaded', async () => {
      const formTable = document.querySelector('.ms-formtable');
      if (!formTable) {
        console.error("Nie znaleziono tabeli formularza.");
        return;
      }
  
      const rows = Array.from(formTable.querySelectorAll("tr"));
  
// Dodaj klasy CSS do wierszy tabeli
rows.forEach((row, index) => {
        if (index % 2 === 0) {
          row.classList.add('even-row');
        } else {
          row.classList.add('odd-row');
        }
      });


      const elements = [
        { name: "SPBookmark_Numer_x0020_przedsi_x0119_wzi_x0", text: "Informacje ogólne", range: [0,20], defaultOpen: true },
        { name: "SPBookmark_Pracownik_x0020_odp_x002e__x0020", text: "Osoby / Daty / Zatwierdzenia / Uwagi", range: [21,38], defaultOpen: true },
        { name: "SPBookmark_Typ_x0020_projektu_x0020_wg_x002", text: "Typ / Ocena Punktowa / Skala Projektu", range: [39, 44] },
        { name: "SPBookmark_USE_x0020_Projektu_x0020__x002d_", text: "Uzasadnienie Społeczno-Ekonomiczne Projektu", range: [45, 56] },
        { name: "SPBookmark_Opis_x002f_przeznaczenie_x0020_P", text: "Opis Produktu Końcowego Projektu", range: [57, 60] },
        { name: "SPBookmark_Formu_x0142_a_x0020_realizacji_x", text: "Formuła Realizacji i Dodatkowe Informacje Dotyczące Finansowania Projektu", range: [61, 68] },
        { name: "SPBookmark_Integracja_x0020_z_x0020_innymi_", text: "Informacje Dotyczące Projektów Informatycznych", range: [69, 71] },
        { name: "SPBookmark_PEI_x0020__x002d__x0020_Planowan", text: "Plan Etapu Inicjowania", range: [72, 77] },
        { name: "SPBookmark_Kierownik_x0020_Projektu", text: "Osoby / Daty / Zatwierdzenia / Uwagi", range: [78, 96] }
      ];
  
      const sections = [
        { title: "SEKCJA 1", filter: ["SPBookmark_Numer_x0020_przedsi_x0119_wzi_x0", "SPBookmark_Pracownik_x0020_odp_x002e__x0020"] },
        { title: "SEKCJA 2", filter: ["SPBookmark_Typ_x0020_projektu_x0020_wg_x002", "SPBookmark_USE_x0020_Projektu_x0020__x002d_","SPBookmark_Opis_x002f_przeznaczenie_x0020_P","SPBookmark_Formu_x0142_a_x0020_realizacji_x","SPBookmark_Integracja_x0020_z_x0020_innymi_","SPBookmark_PEI_x0020__x002d__x0020_Planowan","SPBookmark_Kierownik_x0020_Projektu"] },
        { title: "SEKCJA 3", filter: [], range: [97, rows.length - 1] }
      ];
  
      const formContainer = formTable.parentElement;
  
      const allowedGroups = [
        "ADMINISTRATORZY TECHNICZNI (SZZ)",
        "GOSPODARCZE (SZZ)",
        "SPECJALIŚCI DS. SZP (SZZ)",
      ];
  
      // Funkcja sprawdzająca, czy użytkownik należy do grupy
      async function isUserInAllowedGroup() {
        try {
          const response = await fetch(
            `${_spPageContextInfo.webAbsoluteUrl}/_api/web/currentuser?$expand=Groups`,
            {
              headers: {
                Accept: "application/json;odata=verbose",
              },
            }
          );
  
          if (!response.ok) {
            throw new Error("Błąd podczas pobierania informacji o użytkowniku.");
          }
  
          const data = await response.json();
          const userGroups = data.d.Groups.results.map(group => group.Title);
          return userGroups.some(userGroup =>
            allowedGroups.some(allowedGroup => userGroup.includes(allowedGroup))
          );
        } catch (error) {
          console.error(error);
          return false; // Domyślnie brak dostępu w razie błędu
        }
      }
  
      const userHasAccess = await isUserInAllowedGroup();
  
      sections.forEach(section => {
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'form-section';
  
        const sectionHeader = document.createElement('div');
        sectionHeader.textContent = section.title;
        sectionHeader.className = 'section-header';
  
        const sectionContent = document.createElement('div');
        sectionContent.className = 'section-content';
  
        if (section.title === "SEKCJA 1" || section.title === "SEKCJA 2") {
          sectionContent.style.display = 'block';
        } else if (section.title === "SEKCJA 3" && userHasAccess) {
          sectionContent.style.display = 'block';
        } else {
          sectionContent.style.display = 'none';
        }
  
        if (section.range) {
          rows.slice(section.range[0], section.range[1] + 1).forEach(row => {
            sectionContent.appendChild(row);
          });
        } else {
          elements
            .filter(element => section.filter.includes(element.name))
            .forEach(element => {
              const subSection = document.createElement('div');
              subSection.className = 'sub-section';
  
              const subSectionHeader = document.createElement('div');
              subSectionHeader.textContent = element.text;
              subSectionHeader.className = 'sub-section-header';
  
              const subSectionContent = document.createElement('div');
              subSectionContent.className = 'sub-section-content';
  
              subSectionContent.style.display = element.defaultOpen ? 'block' : 'none';
  
              rows.slice(element.range[0], element.range[1] + 1).forEach(row => {
                subSectionContent.appendChild(row);
              });
  
              subSectionHeader.addEventListener('click', () => {
                subSectionContent.style.display =
                  subSectionContent.style.display === 'none' ? 'block' : 'none';
              });
  
              subSection.appendChild(subSectionHeader);
              subSection.appendChild(subSectionContent);
              sectionContent.appendChild(subSection);
            });
        }
  
        sectionHeader.addEventListener('click', () => {
          sectionContent.style.display =
            sectionContent.style.display === 'none' ? 'block' : 'none';
        });
  
        sectionDiv.appendChild(sectionHeader);
        sectionDiv.appendChild(sectionContent);
        formContainer.appendChild(sectionDiv);
      });
  
      formTable.style.display = "none";
    });
  })();
  </script>
  
  
<style>

.ms-formlabel {
  width: 500px; /* Ustaw żądaną szerokość */
  display: inline-block;
}

.ms-formbody {
  width: 780px; /* Ustaw żądaną szerokość */
  
}

.form-section {
  width: 1280px;
  margin: 10px 0;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 10px;
  background-color: #f9f9f9;
}

.section-header {
  font-weight: bold;
  font-size: 16px;
  background-color: #0078d7;
  color: white;
  padding: 10px;
  border-radius: 5px 5px 0 0;
  cursor: pointer;
}

.section-header:hover {
  background-color: #005a9e;
}

.section-content {
  display: none;
  padding: 10px;
}

.sub-section {
  margin: 10px 0;
  border: 1px solid #ddd;
  border-radius: 5px;
  background-color: #fff;
}

.sub-section-header {

  font-weight: bold;
  padding: 5px;
  background-color: #f7f7f7;
  border-radius: 5px 5px 0 0;
  cursor: pointer;
}

.sub-section-content {

  padding: 5px;
  display: none;
}
.even-row {
  background-color: #ffffff; /* Białe tło dla parzystych wierszy */
}

.odd-row {
  background-color: #c5c4c4; /* Szare tło dla nieparzystych wierszy */
}


</style>